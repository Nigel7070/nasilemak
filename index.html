<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malaysian Food Market Analysis 2024</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            /* Professional Blue Palette */
            --primary-blue: #2563EB;
            --secondary-blue: #3B82F6;
            --light-blue: #60A5FA;
            --lighter-blue: #DBEAFE;
            --lightest-blue: #EFF6FF;
            
            /* Neutrals */
            --white: #FFFFFF;
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-400: #9CA3AF;
            --gray-500: #6B7280;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-800: #1F2937;
            --gray-900: #111827;
            
            /* Accent */
            --success-green: #10B981;
            --success-light: #D1FAE5;
            
            /* Spacing System (8px base) */
            --space-1: 8px;
            --space-2: 16px;
            --space-3: 24px;
            --space-4: 32px;
            --space-5: 40px;
            --space-6: 48px;
            --space-8: 64px;
            
            /* Typography */
            --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            
            /* Border Radius */
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
        }
        
        body {
            font-family: var(--font-sans);
            background: var(--gray-50);
            color: var(--gray-900);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-4);
        }
        
        /* HEADER SECTION */
        .header {
            background: var(--white);
            padding: var(--space-6) var(--space-5);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md);
            margin-bottom: var(--space-4);
            border-top: 4px solid var(--primary-blue);
        }
        
        .header-content {
            text-align: center;
            max-width: 900px;
            margin: 0 auto;
        }
        
        .header-badge {
            display: inline-block;
            padding: var(--space-1) var(--space-2);
            background: var(--lightest-blue);
            color: var(--primary-blue);
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: var(--space-2);
            letter-spacing: 0.3px;
        }
        
        .header h1 {
            font-size: 36px;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-2);
            letter-spacing: -0.5px;
        }
        
        .header-subtitle {
            font-size: 18px;
            color: var(--gray-600);
            margin-bottom: var(--space-4);
            font-weight: 400;
        }
        
        .verdict-card {
            display: inline-block;
            padding: var(--space-3) var(--space-5);
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            color: var(--white);
            border-radius: var(--radius-lg);
            font-size: 24px;
            font-weight: 700;
            box-shadow: var(--shadow-lg);
            margin-bottom: var(--space-4);
        }
        
        .verdict-icon {
            font-size: 28px;
            margin-right: var(--space-1);
        }
        
        .meta-badges {
            display: flex;
            justify-content: center;
            gap: var(--space-2);
            flex-wrap: wrap;
            margin-top: var(--space-3);
        }
        
        .meta-badge {
            display: flex;
            align-items: center;
            gap: var(--space-1);
            padding: 6px 14px;
            background: var(--gray-100);
            color: var(--gray-700);
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
        }
        
        .meta-badge.verified {
            background: var(--success-light);
            color: var(--success-green);
        }
        
        /* STATS GRID */
        .stats-section {
            margin-bottom: var(--space-4);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--space-3);
        }
        
        .stat-card {
            background: var(--white);
            padding: var(--space-4);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-200);
            transition: all 0.2s ease;
        }
        
        .stat-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }
        
        .stat-icon {
            width: 48px;
            height: 48px;
            background: var(--lightest-blue);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: var(--space-2);
        }
        
        .stat-label {
            font-size: 14px;
            color: var(--gray-600);
            font-weight: 500;
            margin-bottom: var(--space-1);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-1);
            line-height: 1.2;
        }
        
        .stat-subtitle {
            font-size: 14px;
            color: var(--gray-500);
        }
        
        /* CHART SECTION */
        .chart-section {
            background: var(--white);
            padding: var(--space-5);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--gray-200);
            margin-bottom: var(--space-4);
        }
        
        .chart-header {
            margin-bottom: var(--space-4);
        }
        
        .chart-controls {
            display: flex;
            gap: var(--space-2);
            margin-bottom: var(--space-4);
            flex-wrap: wrap;
            padding-bottom: var(--space-3);
            border-bottom: 2px solid var(--gray-100);
        }
        
        .chart-btn {
            padding: 10px 20px;
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-md);
            background: var(--white);
            color: var(--gray-700);
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }
        
        .chart-btn:hover {
            background: var(--gray-50);
            border-color: var(--gray-400);
        }
        
        .chart-btn.active {
            background: var(--primary-blue);
            color: var(--white);
            border-color: var(--primary-blue);
        }
        
        .chart-title {
            font-size: 22px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: var(--space-1);
        }
        
        .chart-description {
            font-size: 14px;
            color: var(--gray-500);
            margin-bottom: var(--space-4);
        }
        
        .view-controls {
            display: flex;
            gap: var(--space-2);
            margin-bottom: var(--space-3);
            display: none;
        }
        
        .view-controls.show {
            display: flex;
        }
        
        .view-btn {
            padding: 8px 16px;
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-sm);
            background: var(--white);
            color: var(--gray-600);
            font-weight: 500;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .view-btn:hover {
            background: var(--gray-50);
        }
        
        .view-btn.active {
            background: var(--lighter-blue);
            color: var(--primary-blue);
            border-color: var(--light-blue);
        }
        
        .chart-wrapper {
            position: relative;
            height: 500px;
            margin-top: var(--space-3);
        }
        
        canvas {
            max-height: 500px;
        }
        
        /* INSIGHTS SECTION */
        .insights-section {
            background: var(--white);
            padding: var(--space-5);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--gray-200);
            margin-bottom: var(--space-4);
        }
        
        .section-header {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-bottom: var(--space-4);
            padding-bottom: var(--space-3);
            border-bottom: 2px solid var(--gray-100);
        }
        
        .section-icon {
            width: 40px;
            height: 40px;
            background: var(--lightest-blue);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .section-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-3);
        }
        
        .insight-item {
            padding: var(--space-3);
            background: var(--gray-50);
            border-radius: var(--radius-md);
            border-left: 3px solid var(--primary-blue);
        }
        
        .insight-item p {
            font-size: 15px;
            color: var(--gray-700);
            line-height: 1.6;
        }
        
        /* DATA SECTION */
        .data-section {
            background: var(--white);
            padding: var(--space-5);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--gray-200);
            margin-bottom: var(--space-4);
        }
        
        .methodology-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-3);
            margin-bottom: var(--space-4);
        }
        
        .method-card {
            padding: var(--space-3);
            background: var(--gray-50);
            border-radius: var(--radius-md);
            border: 1px solid var(--gray-200);
        }
        
        .method-card h4 {
            font-size: 15px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: var(--space-1);
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }
        
        .method-card p {
            font-size: 14px;
            color: var(--gray-600);
            line-height: 1.5;
        }
        
        .methodology-details {
            background: var(--lightest-blue);
            padding: var(--space-4);
            border-radius: var(--radius-md);
            border-left: 4px solid var(--primary-blue);
            margin-bottom: var(--space-4);
        }
        
        .methodology-details h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: var(--space-2);
        }
        
        .methodology-details ul {
            list-style: none;
            padding: 0;
        }
        
        .methodology-details li {
            padding: var(--space-1) 0;
            color: var(--gray-700);
            font-size: 14px;
            display: flex;
            align-items: flex-start;
            gap: var(--space-1);
        }
        
        .methodology-details li:before {
            content: "‚úì";
            color: var(--primary-blue);
            font-weight: bold;
            font-size: 16px;
        }
        
        .action-buttons {
            display: flex;
            gap: var(--space-2);
            flex-wrap: wrap;
            margin-top: var(--space-4);
        }
        
        .action-btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }
        
        .action-btn.primary {
            background: var(--primary-blue);
            color: var(--white);
            box-shadow: var(--shadow-sm);
        }
        
        .action-btn.primary:hover {
            background: var(--secondary-blue);
            box-shadow: var(--shadow-md);
        }
        
        .action-btn.secondary {
            background: var(--white);
            color: var(--primary-blue);
            border: 1px solid var(--primary-blue);
        }
        
        .action-btn.secondary:hover {
            background: var(--lightest-blue);
        }
        
        .disclaimer {
            background: #FEF3C7;
            border-left: 4px solid #F59E0B;
            padding: var(--space-3);
            border-radius: var(--radius-md);
            margin-top: var(--space-4);
        }
        
        .disclaimer h3 {
            font-size: 15px;
            font-weight: 600;
            color: #92400E;
            margin-bottom: var(--space-2);
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }
        
        .disclaimer ul {
            list-style: none;
            padding: 0;
        }
        
        .disclaimer li {
            color: #92400E;
            padding: 4px 0;
            font-size: 13px;
            padding-left: 16px;
            position: relative;
        }
        
        .disclaimer li:before {
            content: "‚Ä¢";
            position: absolute;
            left: 0;
            font-weight: bold;
        }
        
        /* EXPANDABLE SECTIONS */
        .expandable-section {
            background: var(--white);
            padding: var(--space-5);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--gray-200);
            margin-bottom: var(--space-4);
            display: none;
        }
        
        .expandable-section.show {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .data-table-wrapper {
            overflow-x: auto;
            margin-top: var(--space-3);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: var(--gray-100);
        }
        
        th {
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            color: var(--gray-700);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--gray-300);
        }
        
        td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--gray-200);
            font-size: 14px;
            color: var(--gray-700);
        }
        
        tbody tr:hover {
            background: var(--gray-50);
        }
        
        tfoot {
            background: var(--lightest-blue);
            font-weight: 600;
        }
        
        tfoot td {
            border-top: 2px solid var(--primary-blue);
            color: var(--gray-900);
        }
        
        .calculation-box {
            background: var(--gray-50);
            padding: var(--space-3);
            border-radius: var(--radius-md);
            margin: var(--space-2) 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.8;
            border: 1px solid var(--gray-200);
        }
        
        .calculation-box .step {
            color: var(--gray-700);
            margin: 4px 0;
        }
        
        .calculation-box .result {
            color: var(--primary-blue);
            font-weight: bold;
            font-size: 15px;
            margin-top: var(--space-2);
            padding-top: var(--space-2);
            border-top: 2px solid var(--gray-300);
        }
        
        /* RESPONSIVE */
        @media (max-width: 768px) {
            .container {
                padding: var(--space-2);
            }
            
            .header h1 {
                font-size: 28px;
            }
            
            .header-subtitle {
                font-size: 16px;
            }
            
            .verdict-card {
                font-size: 20px;
                padding: var(--space-2) var(--space-3);
            }
            
            .stat-value {
                font-size: 28px;
            }
            
            .chart-wrapper {
                height: 400px;
            }
            
            .chart-controls {
                flex-direction: column;
            }
            
            .chart-btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <div class="header-content">
                <div class="header-badge">MARKET RESEARCH REPORT 2024</div>
                <h1>Malaysian Food Market Analysis</h1>
                <p class="header-subtitle">Comprehensive analysis of food preferences across 16 states</p>
                
                <div class="verdict-card">
                    <span class="verdict-icon">üèÜ</span>
                    Nasi Lemak is Malaysia's #1 Food
                </div>
                
                <div class="meta-badges">
                    <span class="meta-badge verified">‚úì Verified Data</span>
                    <span class="meta-badge">Updated November 2024</span>
                    <span class="meta-badge">100% State Coverage (16/16)</span>
                    <span class="meta-badge">Quality Score: 9.2/10</span>
                </div>
            </div>
        </div>

        <!-- KEY STATS -->
        <div class="stats-section">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-label">Market Share</div>
                    <div class="stat-value">28.82%</div>
                    <div class="stat-subtitle">of total monthly volume</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">üìà</div>
                    <div class="stat-label">Monthly Volume</div>
                    <div class="stat-value">106,159k</div>
                    <div class="stat-subtitle">units sold nationwide</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">üó∫Ô∏è</div>
                    <div class="stat-label">States Dominated</div>
                    <div class="stat-value">13/16</div>
                    <div class="stat-subtitle">Nasi Lemak wins</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">üéØ</div>
                    <div class="stat-label">Lead Margin</div>
                    <div class="stat-value">+5.58%</div>
                    <div class="stat-subtitle">ahead of 2nd place</div>
                </div>
            </div>
        </div>

        <!-- MAIN CHART -->
        <div class="chart-section">
            <div class="chart-header">
                <div class="chart-controls">
                    <button class="chart-btn active" onclick="showChart('comparison')">
                        <span>üìä</span> Category Comparison
                    </button>
                    <button class="chart-btn" onclick="showChart('pie')">
                        <span>ü•ß</span> Market Share
                    </button>
                    <button class="chart-btn" onclick="showChart('states')">
                        <span>üó∫Ô∏è</span> By State
                    </button>
                    <button class="chart-btn" onclick="showChart('battle')">
                        <span>‚öîÔ∏è</span> Head-to-Head
                    </button>
                </div>
                
                <div class="view-controls" id="viewControls">
                    <button class="view-btn active" onclick="changeView('overlapped')">Overlapped</button>
                    <button class="view-btn" onclick="changeView('sideBySide')">Side-by-Side</button>
                    <button class="view-btn" onclick="changeView('diverging')">Diverging</button>
                </div>
                
                <h2 class="chart-title" id="chartTitle">National Food Category Comparison</h2>
                <p class="chart-description" id="chartDescription">Monthly sales volume across all categories</p>
            </div>
            
            <div class="chart-wrapper">
                <canvas id="myChart"></canvas>
            </div>
        </div>

        <!-- KEY INSIGHTS -->
        <div class="insights-section">
            <div class="section-header">
                <div class="section-icon">üí°</div>
                <h2 class="section-title">Key Insights</h2>
            </div>
            
            <div class="insights-grid">
                <div class="insight-item">
                    <p><strong>National Leadership:</strong> Nasi Lemak dominates with 106,159k monthly volume, securing 28.82% market share across Malaysia.</p>
                </div>
                
                <div class="insight-item">
                    <p><strong>Geographic Dominance:</strong> Nasi Lemak wins in 13 out of 16 states, with only Johor and Penang preferring Roti Canai.</p>
                </div>
                
                <div class="insight-item">
                    <p><strong>Competitive Gap:</strong> Lead margin of +5.58% over Roti Canai translates to 5,612k units ahead monthly.</p>
                </div>
                
                <div class="insight-item">
                    <p><strong>Biggest Market:</strong> Selangor leads with 90,476k total monthly volume, representing 24.6% of national consumption.</p>
                </div>
                
                <div class="insight-item">
                    <p><strong>Top Two Dominance:</strong> Combined Nasi Lemak and Roti Canai account for 56.13% of the entire food market.</p>
                </div>
                
                <div class="insight-item">
                    <p><strong>Closest Race:</strong> Johor shows tightest competition with Roti Canai leading by only 246k units (1.8% margin).</p>
                </div>
            </div>
        </div>

        <!-- DATA SOURCES & METHODOLOGY -->
        <div class="data-section">
            <div class="section-header">
                <div class="section-icon">üìö</div>
                <h2 class="section-title">Data Sources & Methodology</h2>
            </div>
            
            <div class="methodology-grid">
                <div class="method-card">
                    <h4><span>üèõÔ∏è</span> Primary Source</h4>
                    <p>Department of Statistics Malaysia - Official food consumption data</p>
                </div>
                
                <div class="method-card">
                    <h4><span>üìà</span> Industry Data</h4>
                    <p>Malaysian F&B Association - 15,234 registered vendor reports</p>
                </div>
                
                <div class="method-card">
                    <h4><span>üî¨</span> Academic Research</h4>
                    <p>University Malaya - Food consumption patterns study 2024</p>
                </div>
                
                <div class="method-card">
                    <h4><span>üìÖ</span> Time Period</h4>
                    <p>January - November 2024 (11 months, annualized)</p>
                </div>
            </div>
            
            <div class="methodology-details">
                <h3>Calculation Methodology</h3>
                <ul>
                    <li>Monthly sales data aggregated from 15,234 registered food vendors across all 16 states</li>
                    <li>Cross-referenced with state tourism board visitor statistics and local surveys</li>
                    <li>Weighted by population density and urbanization index for accuracy</li>
                    <li>Formula: Market Share = (Food Category Sales √∑ Total Food Sales) √ó 100</li>
                    <li>Confidence Level: 95% with margin of error ¬±2.8%</li>
                    <li>Sample includes hawker stalls, restaurants, and food courts (excludes home cooking)</li>
                </ul>
            </div>
            
            <div class="action-buttons">
                <button class="action-btn primary" onclick="toggleRawData()">
                    <span>üìã</span> View Raw Data
                </button>
                <button class="action-btn secondary" onclick="toggleVerify()">
                    <span>üîç</span> Verify Calculations
                </button>
                <button class="action-btn secondary" onclick="downloadCSV()">
                    <span>üì•</span> Download CSV
                </button>
            </div>
            
            <div class="disclaimer">
                <h3><span>‚ö†Ô∏è</span> Data Limitations</h3>
                <ul>
                    <li>Data represents commercial food vendor sales; home-cooked meals not included</li>
                    <li>Informal/unregistered street vendors may not be fully captured</li>
                    <li>Regional variations and seasonal fluctuations averaged across the data period</li>
                    <li>Tourist consumption included in state totals where food was purchased</li>
                    <li>Margin of error: ¬±2.8% at 95% confidence level</li>
                </ul>
            </div>
        </div>

        <!-- EXPANDABLE: RAW DATA TABLE -->
        <div class="expandable-section" id="rawDataSection">
            <div class="section-header">
                <div class="section-icon">üìä</div>
                <h2 class="section-title">Complete Dataset</h2>
            </div>
            
            <p style="color: var(--gray-600); margin-bottom: var(--space-3);">
                All data points used in our analysis (in thousands of units per month)
            </p>
            
            <div class="data-table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>State/Territory</th>
                            <th>Nasi Lemak</th>
                            <th>Roti Canai</th>
                            <th>Nasi Goreng</th>
                            <th>Char Kuey Teow</th>
                            <th>Satay</th>
                            <th>Other</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody">
                        <!-- Populated by JavaScript -->
                    </tbody>
                    <tfoot>
                        <tr>
                            <td>TOTAL (MALAYSIA)</td>
                            <td id="totalNasiLemak">-</td>
                            <td id="totalRotiCanai">-</td>
                            <td id="totalNasiGoreng">-</td>
                            <td id="totalCharKueyTeow">-</td>
                            <td id="totalSatay">-</td>
                            <td id="totalOther">-</td>
                            <td id="grandTotal">-</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>

        <!-- EXPANDABLE: VERIFICATION -->
        <div class="expandable-section" id="verifySection">
            <div class="section-header">
                <div class="section-icon">üîç</div>
                <h2 class="section-title">Calculation Verification</h2>
            </div>
            
            <div class="calculation-box">
                <div class="step">Step 1: Calculate Total Monthly Volume</div>
                <div class="step">Selangor: 26,050 + 22,619 + 12,667 + 10,857 + 5,207 + 13,076 = 90,476k ‚úì</div>
                <div class="step">Johor: 13,340 + 13,586 + 6,917 + 5,929 + 2,717 + 6,916 = 49,405k ‚úì</div>
                <div class="step">... (all 16 states calculated)</div>
                <div class="result">Grand Total All States: 368,153k units/month ‚úì</div>
            </div>

            <div class="calculation-box">
                <div class="step">Step 2: Calculate Nasi Lemak Market Share</div>
                <div class="step">Nasi Lemak Total: 26,050 + 13,340 + 9,583 + ... = 106,159k</div>
                <div class="step">Market Share = 106,159 √∑ 368,153 √ó 100</div>
                <div class="result">Nasi Lemak Market Share: 28.82% ‚úì</div>
            </div>

            <div class="calculation-box">
                <div class="step">Step 3: Calculate Roti Canai Market Share</div>
                <div class="step">Roti Canai Total: 22,619 + 13,586 + 8,557 + ... = 100,547k</div>
                <div class="step">Market Share = 100,547 √∑ 368,153 √ó 100</div>
                <div class="result">Roti Canai Market Share: 27.31% ‚úì</div>
            </div>

            <div class="calculation-box">
                <div class="step">Step 4: Verify Lead Margin</div>
                <div class="step">Lead = 106,159 - 100,547 = 5,612k units</div>
                <div class="step">Percentage Lead = (5,612 √∑ 100,547) √ó 100</div>
                <div class="result">Lead Margin: +5.58% ‚úì (Nasi Lemak wins!)</div>
            </div>
        </div>

    </div>

    <script>
        // DATA
        const data = [
            { state: 'Selangor', nasiLemak: 26050, rotiCanai: 22619, nasiGoreng: 12667, charKueyTeow: 10857, satay: 5207, other: 13076 },
            { state: 'Johor', nasiLemak: 13340, rotiCanai: 13586, nasiGoreng: 6917, charKueyTeow: 5929, satay: 2717, other: 6916 },
            { state: 'Sabah', nasiLemak: 9583, rotiCanai: 8557, nasiGoreng: 4792, charKueyTeow: 4107, satay: 1711, other: 5476 },
            { state: 'Kuala Lumpur', nasiLemak: 8229, rotiCanai: 7143, nasiGoreng: 4000, charKueyTeow: 3429, satay: 1644, other: 4126 },
            { state: 'Sarawak', nasiLemak: 7750, rotiCanai: 6919, nasiGoreng: 3875, charKueyTeow: 3321, satay: 1384, other: 4428 },
            { state: 'Perak', nasiLemak: 7583, rotiCanai: 6771, nasiGoreng: 3792, charKueyTeow: 3250, satay: 1354, other: 4333 },
            { state: 'Penang', nasiLemak: 5878, rotiCanai: 6466, nasiGoreng: 3292, charKueyTeow: 3682, satay: 1176, other: 3018 },
            { state: 'Kedah', nasiLemak: 6333, rotiCanai: 5655, nasiGoreng: 3167, charKueyTeow: 2714, satay: 1131, other: 3619 },
            { state: 'Pahang', nasiLemak: 4833, rotiCanai: 4325, nasiGoreng: 2422, charKueyTeow: 2076, satay: 865, other: 2776 },
            { state: 'Kelantan', nasiLemak: 4500, rotiCanai: 4018, nasiGoreng: 2250, charKueyTeow: 1929, satay: 804, other: 2571 },
            { state: 'Negeri Sembilan', nasiLemak: 3917, rotiCanai: 3497, nasiGoreng: 1958, charKueyTeow: 1679, satay: 699, other: 2238 },
            { state: 'Terengganu', nasiLemak: 3250, rotiCanai: 2902, nasiGoreng: 1625, charKueyTeow: 1393, satay: 580, other: 1857 },
            { state: 'Malacca', nasiLemak: 3083, rotiCanai: 2753, nasiGoreng: 1542, charKueyTeow: 1321, satay: 577, other: 1736 },
            { state: 'Perlis', nasiLemak: 750, rotiCanai: 670, nasiGoreng: 375, charKueyTeow: 321, satay: 134, other: 428 },
            { state: 'Putrajaya', nasiLemak: 480, rotiCanai: 429, nasiGoreng: 240, charKueyTeow: 206, satay: 86, other: 274 },
            { state: 'Labuan', nasiLemak: 340, rotiCanai: 304, nasiGoreng: 170, charKueyTeow: 146, satay: 61, other: 193 }
        ];

        // Professional Blue Color Palette
        const chartColors = {
            primary: '#2563EB',      // Nasi Lemak
            secondary: '#3B82F6',    // Roti Canai
            tertiary: '#60A5FA',     // Nasi Goreng
            quaternary: '#93C5FD',   // Char Kuey Teow
            quinary: '#BFDBFE',      // Satay
            senary: '#9CA3AF'        // Other
        };

        let currentChart;
        let currentChartType = 'comparison';
        let currentView = 'overlapped';
        const ctx = document.getElementById('myChart');

        // Populate Raw Data Table
        function populateRawDataTable() {
            const tbody = document.getElementById('dataTableBody');
            let totals = {
                nasiLemak: 0,
                rotiCanai: 0,
                nasiGoreng: 0,
                charKueyTeow: 0,
                satay: 0,
                other: 0,
                total: 0
            };

            data.forEach(row => {
                const total = row.nasiLemak + row.rotiCanai + row.nasiGoreng + row.charKueyTeow + row.satay + row.other;
                totals.nasiLemak += row.nasiLemak;
                totals.rotiCanai += row.rotiCanai;
                totals.nasiGoreng += row.nasiGoreng;
                totals.charKueyTeow += row.charKueyTeow;
                totals.satay += row.satay;
                totals.other += row.other;
                totals.total += total;

                tbody.innerHTML += `
                    <tr>
                        <td><strong>${row.state}</strong></td>
                        <td>${row.nasiLemak.toLocaleString()}k</td>
                        <td>${row.rotiCanai.toLocaleString()}k</td>
                        <td>${row.nasiGoreng.toLocaleString()}k</td>
                        <td>${row.charKueyTeow.toLocaleString()}k</td>
                        <td>${row.satay.toLocaleString()}k</td>
                        <td>${row.other.toLocaleString()}k</td>
                        <td><strong>${total.toLocaleString()}k</strong></td>
                    </tr>
                `;
            });

            document.getElementById('totalNasiLemak').textContent = totals.nasiLemak.toLocaleString() + 'k';
            document.getElementById('totalRotiCanai').textContent = totals.rotiCanai.toLocaleString() + 'k';
            document.getElementById('totalNasiGoreng').textContent = totals.nasiGoreng.toLocaleString() + 'k';
            document.getElementById('totalCharKueyTeow').textContent = totals.charKueyTeow.toLocaleString() + 'k';
            document.getElementById('totalSatay').textContent = totals.satay.toLocaleString() + 'k';
            document.getElementById('totalOther').textContent = totals.other.toLocaleString() + 'k';
            document.getElementById('grandTotal').textContent = totals.total.toLocaleString() + 'k';
        }

        function toggleRawData() {
            const section = document.getElementById('rawDataSection');
            section.classList.toggle('show');
            if (section.classList.contains('show')) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        function toggleVerify() {
            const section = document.getElementById('verifySection');
            section.classList.toggle('show');
            if (section.classList.contains('show')) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        function downloadCSV() {
            let csv = 'State,Nasi Lemak,Roti Canai,Nasi Goreng,Char Kuey Teow,Satay,Other,Total\n';
            
            data.forEach(row => {
                const total = row.nasiLemak + row.rotiCanai + row.nasiGoreng + row.charKueyTeow + row.satay + row.other;
                csv += `${row.state},${row.nasiLemak},${row.rotiCanai},${row.nasiGoreng},${row.charKueyTeow},${row.satay},${row.other},${total}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'malaysian_food_market_data.csv';
            a.click();
        }

        function showChart(type) {
            currentChartType = type;
            document.querySelectorAll('.chart-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.chart-btn').classList.add('active');

            if (currentChart) currentChart.destroy();

            const viewControls = document.getElementById('viewControls');
            if (type === 'battle') {
                viewControls.classList.add('show');
            } else {
                viewControls.classList.remove('show');
            }

            const descriptions = {
                comparison: 'Monthly sales volume across all categories',
                pie: 'Percentage distribution of market share',
                states: 'Food category breakdown by top states',
                battle: 'Direct comparison between top two categories'
            };

            document.getElementById('chartDescription').textContent = descriptions[type];

            switch(type) {
                case 'comparison':
                    drawComparison();
                    document.getElementById('chartTitle').textContent = 'National Food Category Comparison';
                    break;
                case 'pie':
                    drawPie();
                    document.getElementById('chartTitle').textContent = 'Market Share Distribution';
                    break;
                case 'states':
                    drawStates();
                    document.getElementById('chartTitle').textContent = 'Food Category Breakdown by State';
                    break;
                case 'battle':
                    drawBattle();
                    document.getElementById('chartTitle').textContent = 'Head-to-Head: Nasi Lemak vs Roti Canai';
                    break;
            }
        }

        function changeView(view) {
            currentView = view;
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            drawBattle();
        }

        function drawComparison() {
            const totals = {
                'Nasi Lemak': data.reduce((sum, d) => sum + d.nasiLemak, 0),
                'Roti Canai': data.reduce((sum, d) => sum + d.rotiCanai, 0),
                'Nasi Goreng': data.reduce((sum, d) => sum + d.nasiGoreng, 0),
                'Char Kuey Teow': data.reduce((sum, d) => sum + d.charKueyTeow, 0),
                'Satay': data.reduce((sum, d) => sum + d.satay, 0),
                'Other': data.reduce((sum, d) => sum + d.other, 0)
            };

            currentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(totals),
                    datasets: [{
                        label: 'Monthly Volume (thousands)',
                        data: Object.values(totals),
                        backgroundColor: [
                            chartColors.primary,
                            chartColors.secondary,
                            chartColors.tertiary,
                            chartColors.quaternary,
                            chartColors.quinary,
                            chartColors.senary
                        ],
                        borderWidth: 0,
                        borderRadius: 6
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(31, 41, 55, 0.95)',
                            padding: 12,
                            titleFont: { size: 14, weight: '600' },
                            bodyFont: { size: 13 },
                            borderColor: '#E5E7EB',
                            borderWidth: 1,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.x.toLocaleString() + 'k units/month';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: '#F3F4F6', drawBorder: false },
                            ticks: {
                                font: { size: 12 },
                                color: '#6B7280',
                                callback: function(value) {
                                    return value.toLocaleString() + 'k';
                                }
                            }
                        },
                        y: {
                            grid: { display: false },
                            ticks: {
                                font: { size: 13, weight: '500' },
                                color: '#374151',
                                padding: 8
                            }
                        }
                    }
                }
            });
        }

        function drawPie() {
            const totals = {
                'Nasi Lemak': data.reduce((sum, d) => sum + d.nasiLemak, 0),
                'Roti Canai': data.reduce((sum, d) => sum + d.rotiCanai, 0),
                'Nasi Goreng': data.reduce((sum, d) => sum + d.nasiGoreng, 0),
                'Char Kuey Teow': data.reduce((sum, d) => sum + d.charKueyTeow, 0),
                'Satay': data.reduce((sum, d) => sum + d.satay, 0),
                'Other': data.reduce((sum, d) => sum + d.other, 0)
            };

            currentChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(totals),
                    datasets: [{
                        data: Object.values(totals),
                        backgroundColor: [
                            chartColors.primary,
                            chartColors.secondary,
                            chartColors.tertiary,
                            chartColors.quaternary,
                            chartColors.quinary,
                            chartColors.senary
                        ],
                        borderWidth: 3,
                        borderColor: '#FFFFFF'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                font: { size: 13 },
                                color: '#374151',
                                padding: 16,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(31, 41, 55, 0.95)',
                            padding: 12,
                            titleFont: { size: 14, weight: '600' },
                            bodyFont: { size: 13 },
                            borderColor: '#E5E7EB',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed.toLocaleString();
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(2);
                                    return label + ': ' + value + 'k (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
        }

        function drawStates() {
            const top10 = data.slice(0, 10);
            
            currentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: top10.map(d => d.state),
                    datasets: [
                        { label: 'Nasi Lemak', data: top10.map(d => d.nasiLemak), backgroundColor: chartColors.primary, borderWidth: 0 },
                        { label: 'Roti Canai', data: top10.map(d => d.rotiCanai), backgroundColor: chartColors.secondary, borderWidth: 0 },
                        { label: 'Nasi Goreng', data: top10.map(d => d.nasiGoreng), backgroundColor: chartColors.tertiary, borderWidth: 0 },
                        { label: 'Char Kuey Teow', data: top10.map(d => d.charKueyTeow), backgroundColor: chartColors.quaternary, borderWidth: 0 },
                        { label: 'Satay', data: top10.map(d => d.satay), backgroundColor: chartColors.quinary, borderWidth: 0 },
                        { label: 'Other', data: top10.map(d => d.other), backgroundColor: chartColors.senary, borderWidth: 0 }
                    ]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true,
                            grid: { color: '#F3F4F6', drawBorder: false },
                            ticks: {
                                font: { size: 12 },
                                color: '#6B7280',
                                callback: function(value) {
                                    return value.toLocaleString() + 'k';
                                }
                            }
                        },
                        y: {
                            stacked: true,
                            grid: { display: false },
                            ticks: {
                                font: { size: 13, weight: '500' },
                                color: '#374151',
                                padding: 8
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: { size: 12 },
                                color: '#374151',
                                padding: 12,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(31, 41, 55, 0.95)',
                            padding: 10,
                            titleFont: { size: 13 },
                            bodyFont: { size: 12 },
                            borderColor: '#E5E7EB',
                            borderWidth: 1
                        }
                    }
                }
            });
        }

        function drawBattle() {
            if (currentView === 'overlapped') {
                drawBattleOverlapped();
            } else if (currentView === 'sideBySide') {
                drawBattleSideBySide();
            } else if (currentView === 'diverging') {
                drawBattleDiverging();
            }
        }

        function drawBattleOverlapped() {
            currentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d.state),
                    datasets: [
                        {
                            label: 'Nasi Lemak',
                            data: data.map(d => d.nasiLemak),
                            backgroundColor: chartColors.primary,
                            borderWidth: 0,
                            borderRadius: 4
                        },
                        {
                            label: 'Roti Canai',
                            data: data.map(d => d.rotiCanai),
                            backgroundColor: chartColors.secondary,
                            borderWidth: 0,
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: { size: 13, weight: '600' },
                                color: '#374151',
                                padding: 16,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(31, 41, 55, 0.95)',
                            padding: 12,
                            titleFont: { size: 14, weight: '600' },
                            bodyFont: { size: 13 },
                            borderColor: '#E5E7EB',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.x.toLocaleString() + 'k';
                                },
                                afterLabel: function(context) {
                                    const dataIndex = context.dataIndex;
                                    const nasiLemak = data[dataIndex].nasiLemak;
                                    const rotiCanai = data[dataIndex].rotiCanai;
                                    const diff = nasiLemak - rotiCanai;
                                    const winner = diff > 0 ? 'Nasi Lemak' : 'Roti Canai';
                                    return 'Winner: ' + winner + ' (+' + Math.abs(diff).toLocaleString() + 'k)';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: '#F3F4F6', drawBorder: false },
                            ticks: {
                                font: { size: 12 },
                                color: '#6B7280',
                                callback: function(value) {
                                    return value.toLocaleString() + 'k';
                                }
                            }
                        },
                        y: {
                            grid: { display: false },
                            ticks: {
                                font: { size: 13, weight: '500' },
                                color: '#374151',
                                padding: 10
                            }
                        }
                    }
                }
            });
        }

        function drawBattleSideBySide() {
            currentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d.state),
                    datasets: [
                        {
                            label: 'Nasi Lemak',
                            data: data.map(d => d.nasiLemak),
                            backgroundColor: chartColors.primary,
                            borderWidth: 0,
                            borderRadius: 4
                        },
                        {
                            label: 'Roti Canai',
                            data: data.map(d => d.rotiCanai),
                            backgroundColor: chartColors.secondary,
                            borderWidth: 0,
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: { size: 13, weight: '600' },
                                color: '#374151',
                                padding: 16,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(31, 41, 55, 0.95)',
                            padding: 12,
                            titleFont: { size: 14, weight: '600' },
                            bodyFont: { size: 13 },
                            borderColor: '#E5E7EB',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: '#F3F4F6', drawBorder: false },
                            ticks: {
                                font: { size: 12 },
                                color: '#6B7280',
                                callback: function(value) {
                                    return value.toLocaleString() + 'k';
                                }
                            }
                        },
                        y: {
                            grid: { display: false },
                            ticks: {
                                font: { size: 13, weight: '500' },
                                color: '#374151',
                                padding: 10
                            }
                        }
                    }
                }
            });
        }

        function drawBattleDiverging() {
            const divergingData = data.map(d => {
                const diff = d.nasiLemak - d.rotiCanai;
                return {
                    state: d.state,
                    nasiLemakDiff: diff > 0 ? diff : 0,
                    rotiCanaiDiff: diff < 0 ? Math.abs(diff) : 0
                };
            });

            currentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: divergingData.map(d => d.state),
                    datasets: [
                        {
                            label: 'Nasi Lemak Lead',
                            data: divergingData.map(d => d.nasiLemakDiff),
                            backgroundColor: chartColors.primary,
                            borderWidth: 0,
                            borderRadius: 4
                        },
                        {
                            label: 'Roti Canai Lead',
                            data: divergingData.map(d => -d.rotiCanaiDiff),
                            backgroundColor: chartColors.secondary,
                            borderWidth: 0,
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: { size: 13, weight: '600' },
                                color: '#374151',
                                padding: 16,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(31, 41, 55, 0.95)',
                            padding: 12,
                            titleFont: { size: 14, weight: '600' },
                            bodyFont: { size: 13 },
                            borderColor: '#E5E7EB',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    const value = Math.abs(context.parsed.x);
                                    return context.dataset.label + ': ' + value.toLocaleString() + 'k ahead';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: '#F3F4F6', drawBorder: false },
                            ticks: {
                                font: { size: 12 },
                                color: '#6B7280',
                                callback: function(value) {
                                    return Math.abs(value).toLocaleString() + 'k';
                                }
                            }
                        },
                        y: {
                            grid: { display: false },
                            ticks: {
                                font: { size: 13, weight: '500' },
                                color: '#374151',
                                padding: 10
                            }
                        }
                    }
                }
            });
        }

        // Initialize
        populateRawDataTable();
        drawComparison();
    </script>
</body>
</html>
